# Methods

## British Columbia's flatfish fishery

British Columbia's complex of right-eyed flounders is 
a spatially diverse and interacting group. While the
there are several right-eyed flounders in BC waters, we 
will focus only on Dover sole (*Microstomus pacficus*), 
English sole (*Parophrys vetulus*), and rock sole 
(*Lepidopsetta bilineata*), which we will refer to
as the DER complex. We chose these three species
as they are actively managed as part of the BC groundfish fishery 
with the same management unit boundaries, and are
targeted at different times of the year by the same 
bottom trawl sector. 

The DER complex is managed in three spatially distinct stock
areas, which line up with clusters of BC groundfish management
areas, which are themselves made up of groups of Pacific Fishery
Management Areas [@PRIFMP2015]. From North to South, the first extends 
from Dixon Entrance, north of Haida Gwaii, south through 
Hecate Strait; we refer to it as the Hecate Strait/Haida 
Gwaii (HSHG) stock, and it corresponds to BC groundfish 
area 5CDE. The second stock area is Queen Charlotte Sound 
(QCS), or BC groundfish area 5AB. Finally, the third
area extends along the West Coast of Vancouver Island (WCVI) 
from its northern tip down to the entrance to Juan de Fuca Strait,
and corresponds to BC groundfish area 3CD.

All species in the DER complex have been subject to 
exploitation since 


Despite a long history of exploitation, dover sole stocks 
have never been evaluated using model-based assessments. 
No observational data exists for the Queen Charlotte Sound 
(QCS) and west coast of Vancouver Island (WCVI) stocks 
prior to 2003, precluding a model based assessment 
before that time [@fargo1999flatfish-s]. The Haida Gwaii 
and Hecate Strait (HS) stock was surveyed from 
1984 - 2003 (Figure 2, Survey 1), but data was only 
used to perform catch curve analyses for total mortality 
rate estimates [@fargo1998flatfish-s]. During 1984 - 2003, 
a fine-mesh trawl survey was used for the Vancouver Island 
stock and a portion of the Hecate Strait stock, but the 
survey was not designed for groundfish and produced 
stock indices that were highly variable. Since 2003, a 
new bottom trawl survey has operated coast-wide, which 
samples all three stocks (Figure 2, Survey 2), but 
no assessment has been performed in that time.

Dover sole may be suitable for a hierarchical multi-stock 
assessment for 3 main reasons. First, the Hecate Strait 
stock has longer series of informative data than the 
other stocks, potentially providing information for 
the other two stocks. Second, modeling a single-species 
makes it likely that stock productivities and responses 
to the environment are similar. Lastly, all stocks are 
observed by Survey 2, making it likely that the 
observation model parameters for each stock are similar 
for that survey. By applying the hierarchical multi-stock 
approach, the similarities between stocks may be 
exploited to the benefit of the whole complex, extending 
model based stock assessments for dover sole for the 
first time.


## Simulation model framework

Our simulation framework has an operating
model component, and management procedure components. The
stochastic operating model simulates the responses of a 
spatially complex multispecies fish populations to
trawl fishing effort. Fishing effort is allocated
so that no catch exceeds the TAC in for any species
in any area, but at least one species' TAC is fully
utilised in each area.

The operating model (OM) component is a multi-species,
multi-stock age- and sex-structured population dynamics model 
(Appendix A). We conditioned the OM by fitting it as 
a stock assessment model to commercial and survey data
for the DER complex, including commercial catch, CPUE,
and catch-at-age/length and relative survey biomass,
and survey catch-at-age/length. Given the low volume
of biological data from recent time periods, we applied 
a hierarchical multi-species and multi-stock
formulation with shrinkage priors on natural mortality,
stock-recruitment steepness, trawl survey 
catchability, and selectivity-at-length parameters. 
We refer readers to Appendix A for full details.

Closed loop simulations apply the management procedure
iteratively in the following 5 steps over the T years 
of the projection:

1. Use an assessment method to determine stock
status of the complex, either using data pooling,
hierarchical assessments, or single-stock assessments; 
2. Apply a harvest control rule to determine
total allowable catch, and then allocate TAC 
among species if using a data-pooling method;
3. Allocate effort to maximise profits
according to effort allocation model;
4. Generate realised catches from effort with
updated catch rates;
5. Update stochastic population dynamics and
generate new observation data.

Each set of $T$ projection years was repeated
100 times to integrate over observation errors 
and recruitment process errors.

### Surplus production stock assessment models

Management procedures determined stock
status using a flexible process-error surplus 
production model. The flexibility allowed the
same model to be used for all assessment complex
configurations, ranging from data-pooled single
stock assessments with no shrinkage priors, to hierarchical
multi-species and multi-stock assessments. We defined this
model in Template Model Builder, extending
a model from our previous research [@kristensen2015tmb;
@johnson2018evaluating]. For hierarchical model formulations, 
we applied shrinkage priors to survey catchability 
and intrinsic growth rate (Appendix B). In total,
five model configurations were defined:

1. Hierarchical multi-stock
2. Single-stock
3. Hierarchical coastwide (3 species)
4. Hierarchical data-pooled (3 stocks)
5. Data-pooled coastwide (1 stock)


Data is pooled by simple summation of both
catch and biomass indices across species within
each area. This reflects that each species' survey 
biomass index is an estimate of trawlable biomass, 
so the pooled index is an estimate of trawlable
complex biomass available to the survey. We also
summed the CPUE observations for the commercial
trawl fleets, under the assumption that the same
trawl effort was used to calculate the unstandardised
CPUE observations (i.e. the CPUE series had the same
denominators); however, this assumption was inaccurate as the
species-specific CPUE had species-specific effort, and
not all sets catch all three species. Ignoring the
inaccuracy biased the data-pooled CPUE and introduced
more variability, which we decided was acceptable
for research purposes. Under coastwide assessments, 
each survey (pooled or separate) was considered as a 
separate index of the same population.

Each time step $t$, the AM estimates production model 
equilibria $B_{MSY}$ and $U_{MSY}$, and an expected 
biomass estimate $\hat{B}_{t+1}$ for the following 
time step.


### Harvest control rule

To set catch limits for a given stock, or data-pooled complex,
we applied a simple ramped precuationary harvest control 
rule, following Canadian federal policy [@DFO2006A-Harvest-Strat]:
\begin{equation}
U_{t+1} = \left\{ \begin{array}{ll}
            0 & \hat{B}_{t+1} \leq .4\hat{B}_{MSY} \\
            \frac{\hat{B}_{t+1} - .4\hat{B}_{MSY}}{(.6 - .4)\hat{B}_{MSY}} U_{MSY} & 
                .4 < \hat{B}_{t+1}/\hat{B}_{MSY} \leq .6 \\
            \hat{U}_{MSY} & \hat{B}_{t+1} \geq .6\hat{B}_{MSY}
          \end{array} \right.
\end{equation}
Where $\hat{B}_{MSY}$, $\hat{U}_{MSY}$, and $\hat{B}_{t+1}$  
were estimated by the assessment model either for 
a individual species or stocks, or a data-pooled complex.

Total allowable catch (TAC) was then set as the product
of target harvest rate and projected biomass
\begin{equation}
TAC_{t+1} = U_{t+1} \cdot \hat{B}_{t+1}.
\end{equation}
In situations where the assessment model scale matched
the operating model scale, then TACs were passed directly
to the effort allocation model. In other cases when data were
pooled or stock structure was ignored, we defined rules
for allocating TAC among areas and species.

For coastwide assessments all three stock
area survey series were used, so TAC was apportioned 
according to the relative survey catchability estimated
by the assessment model, i.e.
\begin{equation}
TAC_{p,t+1} = \frac{\hat{q}_p}{ \sum_{p'} \hat{q}_{p'} } TAC_{t+1}. 
\end{equation}
This reflects the assumption that survey indices
are relative, or minimum, trawlable biomass estimates,
and catchability coefficients are then an indicator
of the proportion of total coastwide biomass available 
to the survey in each area. We normalise by the total
catchability coefficient as we do not expect
that they will sum to 1, indicating that some fish 
remain invulnerable to the survey, either by being 
higher in the water column, or in non-trawlable habitat.

For splitting TAC within an area when data has been pooled,
we split them according to the relative contribution of each
species to the pooled data. For example, if the pooled biomass 
index for stock area $p$ in time step $t$ was the sum of species
specific indices in the same area, i.e,
\begin{equation}
I_{p,t} = \sum_s I_{s,p,t},
\end{equation}
then the TAC for species $s$ is simply
\[
TAC_{s,p,t+1} = \frac{I_{s,p,t}}{I_{p,t}} TAC_{p,t+1}.
\]


### Fishing effort allocation and fishing mortality

We allocated maximum fishing effort to each area. 
Maximum effort was defined as the amount required to
fully utilise the TAC of at least one species, 
but never exceed any of the three species' TACs. 
Effort was then supplied to the operating model to
generate realised fishing mortality among
species and stock areas as
\begin{equation}
F_{s,p,f,t} = \bar{q}^{(F)}_{s,p,f} * E_{s,p,f,t},
\end{equation}
where $\bar{q}^{(F)}_{s,p,f}$ is the average 
ratio of fishing mortality to fishing
effort, estimated from the historical data
and the OM conditioning assessment. ***UNDERFULFILMENT?***

We chose to use maximum effort over an effort dynamics
model because of (i) its simplicity and (ii) its similarity 
to other MSE simulations for BC fisheries. We considered 
including an effort dynamics model to allocate a pool 
of effort over the three areas [@hilborn1987general;
@walters1999multispecies], but determined that this was
not necessary for determining the management performance 
of the multiple assessment models that we are testing.
Furthermore, although the BC groundfish fishery balances
the utilisation of many more than three TACs in practice,
avoiding fully utilising TACs to account for future bycatch,
we found that the maxmium effort model effectively 
simulated the TAC under-utilisations for two species 
out of the three. Finally, BC sablefish, herring, and
outside yelloweye rockfish use full TAC utilisation 
in their management simulations
[@cox2019evaluating;**INSERT HERRING and OYE CSAS HERE**],
under the assumption that full TAC utilisation provides
and upper bound on the management risk.


## Simulation experiments and performance

For the main experiment, we ran a total of $20$ 
simulations, made up of fully factorial combinations 
of four OM scenario and five management procedures. 
We ran 100 replicates of each OM/MP, each initialised
with a unique random seed, thereby integrating 
over all stochastic processes. To eliminate the
effect of random variation between simulations, 
each simulation was initialised with the same set
of 100 random seeds. We ran extra replicates until the 
sample size of 100 was reached when AMs failed to
converge in the closed loop simulations.

### OM scenarios

We tested our five MPs against four operating model 
scenarios. Each scenario simulated an increase or 
decrease in data quality at the beginning of the 
projection period. Changes in data quality were
controlled by a change in the observation error 
standard deviation for the Synoptic trawl survey series, 
which is the only series that is carried 
into the projections and used for management.

Projection period? 2 generations - add gen time
calc to ref points.

Survey CV scenarios:
1. Current $\tau_{s,p,f}$ value from conditioning;
2. Half current SD: $\tau_{s,p,f,proj} = 0.5 \cdot \tau_{s,p,f}$;
3. Twice current SD: $\tau_{s,p,f,proj} = 2 \cdot \tau_{s,p,f}$;
4. Four times current SD: $\tau_{s,p,f,proj} = 4 \cdot \tau_{s,p,f}$

Given the need for informative prior distributions to stabilise
the assessment model behaviour in simulations, we also
conducted some sensitivity analyses. Sensitivity
runs focused on the prior distributions applied to
the Bmsy and Umsy values used in
Sensitivity runs:
1. Bmsy prior CV = 0.1, 0.5, 1.0
2. Random Bmsy prior mean drawn from the conditioning 
assessment's posterior?


### Management procedures

We tested five MPs corresponding to the five assessment 
model configurations outlined above. We chose to restrict
ourselves to the AM configuration only, as this would
allow us to focus on the management performance
of the range of models under different data quality 
scenarios, rather than the interaction between the
assessment model and other management procedure components.

### Performance metrics

Given that no set of formal management objectives exists
for the BC flatfish fishery, we decided to generic
conservation metrics to evaluate the
conservation performance of our management procedures
(metrics 1 - 3 below). In addition to the standard 
average catch and annual average variation (metrics 4
and 5), we also defined quota utilisation
and average revenue metrics for evaluating the
MPs from a commercial point of view.

1. $P(B_{s,p,t} < .4B_{MSY,s,p})$: the probability of 
biomass falling below the generally accepted limit 
reference point of 40% of $B_{MSY}$;
2. $P(B_{s,p,t} < .8B_{MSY,s,p})$: the probability that
a stock is in an overfished state;
3. $P(U_{s,p,t} > U_{MSY,s,p})$: the probability that
overfishing occured;
4. $\bar{C}_{s,p,t}$: average catch;
5. $AAV_{s,p}$: the average annual variation in catch
\begin{equation*}
AAV_{s,p} = \frac{\sum_t |C_{s,p,t} - C_{s,p,t+1} | }{\sum_t C_{s,p,t}}.
\end{equation*}
6. $C_{s,p,t} / TAC_{s,p,t}$: quota utilisation ratios?

All metrics are calculated over the first ten years 
of the projection period.


