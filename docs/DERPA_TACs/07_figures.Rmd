# Figures

```{r loadStuff, echo = FALSE, include = FALSE, warning = FALSE}
.loadSim("sim_parBatDLSurveys_.3tau_Long17", folder= params$groupFolder)


```



```{r figCaptions, echo = FALSE, include = FALSE, warning = FALSE }

DERcplxMapCap <- "Mininum trawlable survey biomass $B_{trawl}$ estimates for DER 
complex species on the BC coast, aggregated to a 10km square grid.
Estimates are produced by scaling average trawl survey ($kg/m^2$) 
density values in each grid cell by the cell's area in $m^2$. 
Locations that do not show a coloured grid cell do not have any 
survey blocks from which to calculate relative biomass. Survey density 
for each grid cell is calculated from data for the Hecate Strait 
Assemblage Survey and the BC Groundfish Trawl Synoptic Survey, stored 
in the GFBio data base maintained at the Pacific Biological Station 
of Fisheries and Oceans, Canada. Thick black lines delineate the major 
statistical areas 3CD and 5ABCDE used for groundfish management BC, while
the dashed grey lines makr out latitude and longitude, indicating the
rotation of the coordinates to save space. The full colour figure 
is available in the online version of the article."

histStatusCap <- "Historical spawning biomass (red line) and catch (grey bars)
for all 9 management units in the DER complex operating model. Species labels are at the top of each
column, and stock area labels are on the right hand end of each row. Points
are scaled commercial CPUE and survey biomass indices, which are scaled from
data to spawning biomass by observation catchability and the ratio of model
estimates of spawning and exploitable biomass, 
e.g. $\\hat{I}^{(s)}_{spft} = \\frac{I_{spft}}{q_{spf}} \\cdot \\frac{\\hat{B}_{spt}}{\\hat{B}_{spft}}$."


yieldCurveCap <- "Operating model equilibrium yield curves for a given
fishing effort for the nine DER complex management units, as well as 
complex yield curves within each stock area. Each panel shows the three
individual DER complex species yield curves within a given stock area in
different colours, and the complex yield curve found by summing the three
yield curves as a thick black line."

omniBtCtTulipsCap <- "Spawning biomass depletion and relative catch 
simulation envelopes for all nine DER complex management units from 
the omniscient manager simulations. Median biomass is shown by the thick 
black line, with the grey region showing the central 95\\% of the 
distribution of spawning biomass, and thin black lines 
showing three randomly selected simulation replicates. Catch is shown as grey 
bars in the historical period, which represent median catch in the projection, 
with thin vertical line segments showing the central 95\\% of the catch 
distribution. The depletion level associated with the traditional single 
species optimal biomass $B_{MSY,SS}$ is shown as a dashed horizontal green 
line, while the depletion level associated with our derived complex 
level multi-species optimal yield is shown as a blue horizontal dashed line.
"

omniEffTulipsCap <- "Commercial fishing effort simulation envelopes for 
each stock area. Historical and median simulated effort in the projection 
period are shown by a thicker black line, while the central 95\\% of the 
distribution of simulated effort is shown as grey shaded region in the 
projection period. Single simulation replicates in the projection period 
are shown as thinner black lines."

lossCatAbsCap  <- "Distributions of cumulative absolute loss in catch (kt) 
for the projection years 2026 to 2036 under each assessment model and
OM data scenario (x-axis labels). The points show the median loss, 
while line segments show the central 90\\% of cumulative loss 
distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each assessment model point type and 
colour is shown in the legend at the bottom. Loss distributions
for assessment models that couldn't reach 100 replicates with satisfactory
convergence are shown as a dashed line."

tulipBtCtHMSPoorCap <- "Spawning biomass depletion and relative catch 
simulation envelopes for all nine DER complex management units when 
assessed by the Hierarchical Multi-stock assessment model under the 
Poor data-quality scenario. Median biomass is shown by the thick 
black line, with the grey region showing the central 95\\% of the 
distribution of spawning biomass, and thin black lines 
showing three randomly selected simulation replicates. Catch is shown as grey 
bars in the historical period, which represent median catch in the projection, 
with thin vertical line segments showing the central 95\\% of the catch 
distribution. Coloured circles on the right hand vertical axis show 
the biomass depletion level associated with the multi-species 
(closed blue circle) and single-species (open green circle) 
maximum sustainable yield."


retroBioSingleRepSSComm1Cap <- "Operating model spawning stock
biomass (red line), commercial trawl vulnerable biomass (grey dotted line), 
retrospective assesment model estimates of spawning stock 
biomass (thin grey/purple lines), and catch and TACs (grey bars) 
from the first simulation replicate in the Rich data-quality scenario
under the Single-stock assessment model. Catch bars show realised catch in grey 
for the whole simulation period, and unfilled bars in the projection
period show the difference between MP set TACs and realised catch.
Coloured circles on the right hand vertical axis show the biomass 
level associated with the multi-species (closed blue circle) and 
single-species (open green circle) maximum sustainable yield."


retroBioSingleRepHMSPoorCap <- "Operating model spawning stock
biomass (red line), commercial trawl vulnerable biomass (grey dotted line), 
retrospective assesment model estimates of spawning stock 
biomass (thin grey/purple lines), and catch and TACs (grey bars) 
from the first simulation replicate in the Poor data-quality scenario and
under the Hierarchical Multi-stock assessment model. Catch bars show realised 
catch in grey for the whole simulation period, and unfilled bars 
in the projection period show the difference between MP set TACs 
and realised catch. Coloured circles on the right hand vertical axis 
show the biomass level associated with the multi-species 
(closed blue circle) and single-species (open green circle) 
maximum sustainable yield."

catchBioTradeoffCap <- "Tradeoff between catch and biomass 
during the 2028 - 2037 period implied by switching between 
different assessment models under Rich and Poor data-quality scenarios. 
Panels are gridded by species (columns) and stocks (rows), with biomass 
relative to $B_{MSY,MS,s,p}$ on the horizontal axis, and catch 
relative to $MSY_{MS,s,p}$ on the vertical axis. Distributions of
biomass and catch under the omniscient manager are shown by the 
black crosshair, with points indicating optimal biomass and yield
for single species maximum yield (open green circles) and 
multi-species maximum yield (closed blue circles). The biomass 
level at which a stock is critically overfished is shown as a vertical
red dashed line. Coloured point symbols show median biomass and catch 
for over all replicates for different assessment models, with assessment 
models under the same data-quality scenario joined by a solid line 
(Rich) or dashed line (Poor)."

batchLossSensSummaryCap <- "Regressions showing the average 
sensitivity of cumulative catch loss to the prior standard
deviations under each assessment model (colours, line types) for the 
data-rich (left column) and data-poor (right column) scenarios. 
The horizontal axis on each plot shows the prior standard deviation 
(CV for $B_{MSY}$), while the vertical axis shows the standardised 
difference between median cumulative loss for an assessment model and the mean
of median cumulative loss values over AMs, stratified by species
and area. See the online version of the journal for a full colour 
version of the plot."

```

```{r fig1-DERccomplexSurveyBio, echo = FALSE, warning = FALSE, fig.cap = DERcplxMapCap }
figPath <- file.path("./data/fig1-DERcomplexSurveyBio.pdf")
knitr::include_graphics(figPath)
```

\clearpage


```{r fig2-complexYieldCurves, echo = FALSE, warning = FALSE, fig.cap = yieldCurveCap, fig.width = 6 }
# Load a blob, probably just the first one
# in the group folder
# plotEffYieldCurves(blob, maxE = 60)
figPath <- file.path("./data/fig2-complexYieldCurves.pdf")
knitr::include_graphics(figPath)

```

\clearpage

\blandscape{}

```{r fig3-omniBtCtTulips, echo = FALSE, warning = FALSE, fig.cap = omniBtCtTulipsCap, fig.width = 9, out.width = "9in"  }
figPath <- file.path("./data/fig3-omniRunTulipBt.pdf")
knitr::include_graphics(figPath)
```


\clearpage

\elandscape

```{r fig4-omniEffTulips, echo = FALSE, warning = FALSE, fig.cap = omniEffTulipsCap }
figPath <- file.path("./data/fig4-omniEffortTulip.pdf")
knitr::include_graphics(figPath)
```

\blandscape


\clearpage

```{r fig5-batchLossAbsCatch, echo = FALSE, warning = FALSE, fig.cap = lossCatAbsCap, fig.width = 9, out.width = "9in" }
# plotBatchLossDists_Scenario(  groupFolder = params$groupFolder,
#                               prefix = "parBat",
#                               lossType = "abs",
#                               var = "C_ispt",
#                               period = 73:82,
#                               lossList = NULL,
#                               dim1 = 1:3,   # species (D,E,R, DP)
#                               dim2 = 1:3,   # stocks (H,Q,W, CW)
#                               qProbs = c(.05,.5,.95),
#                               scenLabs = c( Rich  = "DERfit_HcMcAsSsIdx",
#                                             Mod   = "DERfit_McAsSsIdx",
#                                             Poor  = "DERfit_AsSsIdx" ),
#                               clearBadReps = TRUE,
#                               minSampSize = 100 )

figPath <- file.path("./data/fig5-batchLossAbsCatch.pdf")
knitr::include_graphics(figPath)

```

\clearpage

```{r fig6-tulipBtCtHMSPoor, echo = FALSE, warning = FALSE, fig.cap = tulipBtCtHMSPoorCap, fig.width = 9, out.width = "9in" }
# plotTulipBt(  obj = blob, nTrace = 3,
#               dep = TRUE,
#               ref = "B0",
#               Ct  = TRUE,
#               leg = FALSE,
#               clearBadReps = TRUE,
#               printStamp = FALSE )

figPath <- file.path("./data/fig6-tulipBtCtHMSPoor.pdf")
knitr::include_graphics(figPath)

```

\clearpage

```{r fig7-retroBioSingleRepHMSPoor, echo = FALSE, warning = FALSE, fig.cap = retroBioSingleRepHMSPoorCap, fig.width = 9, out.width = "9in" }
# plotRetroSBagg(  obj = blob, iRep = 1, plotStamp = FALSE )
figPath <- file.path("./data/fig7-retroBioSingleRepHMSPoor.pdf")
knitr::include_graphics(figPath)

```



\clearpage

```{r fig8-catchBioTradeoff, echo = FALSE, warning = FALSE, fig.cap = catchBioTradeoffCap, fig.width = 9, out.width = "9in"  }
# plotBatchCatchBioTradeoff(  groupFolder = params$groupFolder,
#                             prefix = "parBat",
#                             period = 73:82,
#                             lossList = NULL,
#                             qProbs = c(.025,.5,.975),
#                             refPts = "MSrefPts",
#                             AMlabs = c( SS = "singleStock",
#                                         HMS = "hierMultiStock",
#                                         SpePool = "speciesPooling",
#                                         SpaPool = "spatialPooling",
#                                         TA = "totalAgg" ),
#                             scenLabs = c( Rich  = "DERfit_HcMcAsSsIdx",
#                                           Poor = "DERfit_AsSsIdx" ),
#                             minSampSize = 100  )

figPath <- file.path("./data/fig8-catchBioTradeoff.pdf")
knitr::include_graphics(figPath)
```

\clearpage

```{r fig9-regLossSensitivityRuns, echo = FALSE, warning = FALSE, fig.cap = batchLossSensSummaryCap, fig.width = 8, out.width = "8in"  }


# scenLabs <- list( BmsyCVrich = c( Rich_BmsyCV0.1  = "Comm1_BmsyCV0.1",
#                                   Rich_BmsyCV0.5  = "Comm1_BmsyCV0.5",
#                                   Rich_BmsyCV1.0  = "Comm1_BmsyCV1.0"),
#                   BmsyCVpoor = c( Poor_BmsyCV0.1  = "Surv_BmsyCV0.1",
#                                   Poor_BmsyCV0.5  = "Surv_BmsyCV0.5",
#                                   Poor_BmsyCV1.0  = "Surv_BmsyCV1.0" ),
#                   UmsyCVrich = c( Rich_UmsyCV0.1  = "Comm1_UmsyCV0.1",
#                                   Rich_UmsyCV0.5  = "Comm1_UmsyCV0.5",
#                                   Rich_UmsyCV1.0  = "Comm1_UmsyCV1.0"),
#                   UmsyCVpoor = c( Poor_UmsyCV0.1  = "Surv_UmsyCV0.1",
#                                   Poor_UmsyCV0.5  = "Surv_UmsyCV0.5",
#                                   Poor_UmsyCV1.0  = "Surv_UmsyCV1.0" ),
#                   hierSDrich = c( Rich_hierSD0.1  = "Comm1_shrinkSD0.1",
#                                   Rich_hierSD0.5  = "Comm1_shrinkSD0.5",
#                                   Rich_hierSD1.0  = "Comm1_shrinkSD1.0"),
#                   hierSDpoor = c( Poor_hierSD0.1  = "Surv_shrinkSD0.1",
#                                   Poor_hierSD0.5  = "Surv_shrinkSD0.5",
#                                   Poor_hierSD1.0  = "Surv_shrinkSD1.0" ))

# scenSplitString <- c( Bmsy    = "BmsyCV",
#                       Umsy    = "UmsyCV",
#                       hierSD  = "shrinkSD" )

# xlab <- c(  Bmsy = expression(CV(B[MSY])), 
#             Umsy = expression( SD(U[MSY])), 
#             hierSD = expression(paste( tau[q], " and ", sigma[U[MSY]] ) ) )

# groupFolders <- c("sensRuns_BmsyCV", "sensRuns_UmsyCV","sensRuns_hierSD")


# par( mfcol = c(2,3), oma = c(5,3,2,1), mar = c(2,2,1,1) )
# for( sensIdx in 1:3 )
# {

#   plotSensBatchSummary_SAisp( groupFolder = groupFolders[sensIdx],
#                               prefix = "parBat",
#                               lossType = "abs",
#                               var = "C_ispt",
#                               period = 73:82,
#                               lossList = NULL,
#                               refPts = NULL,
#                               AMlabs = c( SS = "singleStock",
#                                           HMS = "hierMultiStock",
#                                           SpePool = "speciesPooling",
#                                           SpaPool = "spatialPooling",
#                                           TA = "totalAgg" ),
#                               scenLabs = scenLabs[[2 * sensIdx - 1]],
#                               clearBadReps = FALSE,
#                               scenSplitString = scenSplitString[sensIdx],
#                               xlab = xlab[sensIdx],
#                               noPar = TRUE,
#                               printLeg = FALSE
#                            )

#   if( sensIdx == 3)
#     rmtext( txt = "Rich", font = 2, line = .05, outer = TRUE )

#   plotSensBatchSummary_SAisp( groupFolder = groupFolders[sensIdx],
#                               prefix = "parBat",
#                               lossType = "abs",
#                               var = "SB_ispt",
#                               period = 73:82,
#                               lossList = NULL,
#                               refPts = NULL,
#                               AMlabs = c( SS = "singleStock",
#                                           HMS = "hierMultiStock",
#                                           SpePool = "speciesPooling",
#                                           SpaPool = "spatialPooling",
#                                           TA = "totalAgg" ),
#                               scenLabs = scenLabs[[2 * sensIdx]],
#                               clearBadReps = FALSE,
#                               scenSplitString = scenSplitString[sensIdx],
#                               xlab = xlab[sensIdx],
#                               noPar = TRUE,
#                               printLeg = FALSE
#                            )

#   if( sensIdx == 3)
#     rmtext( txt = "Poor", font = 2, line = .05, outer = TRUE )
  

#   # mtext( side = 1, text = xlab[sensIdx], font = 2, line = 3)
# }

# mtext( side = 2, text = "Std. diff from mean cumulative loss", 
#         outer = TRUE, line = 1)
# # Plot legend
# par(fig=c(0, 1, 0, 1), oma=c(0, 0, 0, 0), mar=c(0, 0, 0, 0), new=TRUE)
#   plot(0, 0, type='n', bty='n', xaxt='n', yaxt='n')
#   legend( x       = "bottom",
#           horiz   = TRUE,
#           bty     = "n",
#           legend  = c("Single-stock","Hierarchical","Species Pooling","Spatial Pooling","Total Aggregation"),
#           lty     = 1:5,
#           col     = RColorBrewer::brewer.pal(5,"Dark2"), 
#           lwd     = 2 )

figPath <- file.path("./data/fig9-regLossSensitivityRuns.pdf")
knitr::include_graphics(figPath)

```

\elandscape
