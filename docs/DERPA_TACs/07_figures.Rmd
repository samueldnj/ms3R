# Figures

```{r loadStuff, echo = FALSE, include = FALSE, warning = FALSE}
.loadSim("sim_parBatDLSurveys_.3tau_Long17", folder= params$groupFolder)


```



```{r figCaptions, echo = FALSE, include = FALSE, warning = FALSE }

DERcplxMapCap <- "Mininum trawlable survey biomass $B_{trawl}$ estimates for DER 
complex species on the BC coast, aggregated to a 10km square grid.
Estimates are produced by scaling average trawl survey ($kg/m^2$) 
density values in each grid cell by the cell's area in $m^2$. 
Locations that do not show a coloured grid cell do not have any 
survey blocks from which to calculate relative biomass. Survey density 
for each grid cell is calculated from data for the Hecate Strait 
Assemblage Survey and the BC Groundfish Trawl Synoptic Survey, stored 
in the GFBio data base maintained at the Pacific Biological Station 
of Fisheries and Oceans, Canada. Thick black lines delineate the major 
statistical areas 3CD and 5ABCDE used for groundfish management BC, while
the dashed grey lines makr out latitude and longitude, indicating the
rotation of the coordinates to save space. The full colour figure 
is available in the online version of the article."

histStatusCap <- "Historical spawning biomass (red line) and catch (grey bars)
for all 9 management units in the DER complex operating model. Species labels are at the top of each
column, and stock area labels are on the right hand end of each row. Points
are scaled commercial CPUE and survey biomass indices, which are scaled from
data to spawning biomass by observation catchability and the ratio of model
estimates of spawning and exploitable biomass, 
e.g. $\\hat{I}^{(s)}_{spft} = \\frac{I_{spft}}{q_{spf}} \\cdot \\frac{\\hat{B}_{spt}}{\\hat{B}_{spft}}$."


yieldCurveCap <- "Operating model equilibrium yield curves for a given
fishing effort for the nine DER complex management units, as well as 
complex yield curves within each stock area. Each panel shows the three
individual DER complex species yield curves within a given stock area in
different colours, and the complex yield curve found by summing the three
yield curves as a thick black line."

omniBtCtTulipsCap <- "Spawning biomass depletion and relative catch 
simulation envelopes for all nine DER complex management units from 
the omniscient manager simulations. Median biomass is shown by the thick 
black line, with the grey region showing the central 95\\% of the 
distribution of spawning biomass, and thin black lines 
showing three randomly selected simulation replicates. Catch is shown as grey 
bars in the historical period, which represent median catch in the projection, 
with thin vertical line segments showing the central 95\\% of the catch 
distribution. The depletion level associated with the traditional single 
species optimal biomass $B_{MSY,SS}$ is shown as a dashed horizontal green 
line, while the depletion level associated with our derived complex 
level multi-species optimal yield is shown as a blue horizontal dashed line.
"

omniEffTulipsCap <- "Commercial fishing effort simulation envelopes for 
each stock area. Historical and median simulated effort in the projection 
period are shown by thicker green (comm.hist) and orange (comm.mod) lines, 
while the central 95% of the distribution of simulated effort is shown as 
the orange shaded region in the projection period. Single simulation 
replicates in the projection period are shown as thinner orange lines."

retroBioSampleFitCap <- "Operating model spawning stock
biomass (red line) and retrospective assesment model 
estimates of spawning stock biomass (grey lines) under 
the Comm2 scenario. Panels show the single-stock (top row)
and hierarchical multi-stock (second row) model fits to all
species in the HSHG area, and pooled AM model fits (bottom row,
left to right) to spatially pooled data for Dover sole, species 
pooled data for the HSHG area, and totally aggregated data for
the entire DER complex."

lossCatRelCap  <- "Distributions of cumulative relative loss in catch 
for the projection years 2026 to 2036 under each AM and
OM data scenario (x-axis labels). The points show the median loss, 
while line segments show the central 90\\% of cumulative loss 
distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 100 replicates with satisfactory
convergence are shown as a dashed line."

lossCatAbsCap  <- "Distributions of cumulative absolute loss in catch (kt) 
for the projection years 2026 to 2036 under each AM and
OM data scenario (x-axis labels). The points show the median loss, 
while line segments show the central 90\\% of cumulative loss 
distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 100 replicates with satisfactory
convergence are shown as a dashed line."

lossBioRelCap  <- "Distributions of cumulative relative loss in 
spawning biomass for the projection years 2026 to 2036 under each AM and
OM data scenario (x-axis labels). The points show the median loss, 
while line segments show the central 90\\% of cumulative loss 
distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 100 replicates with satisfactory
convergence are shown as a dashed line."

lossBioAbsCap  <- "Distributions of cumulative absolute loss in 
spawning biomass (kt) for the projection years 2026 to 2036 under 
each AM and OM data scenario (x-axis labels). The points show the 
median loss, while line segments show the central 90\\% of cumulative 
loss  distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 100 replicates with satisfactory
convergence are shown as a dashed line."

tulipBtCtHMSSurvCap <- "Spawning biomass depletion and relative catch 
simulation envelopes for all nine DER complex management units when 
assessed by the hierarchical multi-stock AM under the 
Surv OM scenario. Median biomass is shown by the thick 
black line, with the grey region showing the central 95\\% of the 
distribution of spawning biomass, and thin black lines 
showing three randomly selected simulation replicates. Catch is shown as grey 
bars in the historical period, which represent median catch in the projection, 
with thin vertical line segments showing the central 95\\% of the catch 
distribution. The depletion level associated with the traditional single 
species optimal biomass $B_{MSY,SS}$ is shown as a dashed horizontal green 
line, while the depletion level associated with our derived complex 
level multi-species optimal yield $B_{MSY,MS}$ is shown as a blue 
horizontal dashed line."


retroBioSingleRepSSComm1Cap <- "Operating model spawning stock
biomass (red line), commercial trawl vulnerable biomass (grey dotted line), 
retrospective assesment model estimates of spawning stock 
biomass (thin grey/purple lines), and catch and TACs (grey bars) 
from the first simulation replicate in the Comm1 scenario and
under the single-stock AM. Catch bars show realised catch in grey 
for the whole simulation period, and unfilled bars in the projection
period show the difference between MP set TACs and realised catch.
Purple lines show time steps where the simulate assessment model
did not have a positive-definite hessian. Coloured circles on the
right hand vertical axis show the biomass level associated with
the multi-species (closed blue circle) and single-species (open
green circle) maximum sustainable yield."


retroBioSingleRepHMSSurvCap <- "Operating model spawning stock
biomass (red line), commercial trawl vulnerable biomass (grey dotted line), 
retrospective assesment model estimates of spawning stock 
biomass (thin grey/purple lines), and catch and TACs (grey bars) 
from the first simulation replicate in the Surv scenario and
under the hierarchical multi-stock AM. Catch bars show realised 
catch in grey for the whole simulation period, and unfilled bars 
in the projection period show the difference between MP set TACs 
and realised catch. Purple lines show time steps where the 
simulate assessment model did not have a positive-definite 
hessian. Coloured circles on the right hand vertical axis 
show the biomass level associated with the multi-species 
(closed blue circle) and single-species (open green circle) 
maximum sustainable yield."

TACutilisationSSLowCVCap <- "Simulation envelopes of TAC utilisation,
under the hierarchical multi-stock AM and the Surv OM scenario.
Columns are species, rows are stock areas. Heavy black lines show the 
median TAC utilisation, with thin black lines showing 3 
random replicates, and the grey region showing the central 95\\% 
of simulation's distribution."

assErrSSLowCVCap <- "Simulation envelopes of hierarchical
multi-stock relative assessment model errors under the 
Surv OM scenario. Columns are species, rows are stock areas. 
Heavy black lines show the median relative assessment error
in each projection year, with thin black lines showing 3 
random replicates, and the grey region showing the central 95\\% 
of simulation's distribution."

catchBioTradeoffCap <- "Tradeoff between catch and biomass 
implied by switching between different AMs under the same
operating model scenario. Panels are gridded by species (columns)
and stocks (rows), with biomass scaled by stock-specific
biomass at multi-species maximum yield $B_{MSY,MS,s,p}$ on
the horizontal axis, and catch scaled by multi-species maximum
yield $MSY_{MS,s,p}$ on the vertical axis, with thicker black
dashed reference lines showing $B_{MSY,MS,s,p}$ and $MSY_{MS,s,p}$. 
Coloured point symbols show median biomass and catch for the period
2026 - 2025 and all replicates for different AMs, and AMs within 
the same scenario are joined by a line, with symbols and line 
types explained in the figure legend."


lossCatAbsBmsyPriorSensCap  <- "Distributions of cumulative absolute 
loss in catch biomass (kt) for the projection years 2026 to 2035 under 
each AM for the $B_{MSY}$ Prior CV sensitivity analysis scenarios (x-axis 
labels). The points show the median loss, while line segments show 
the central 90\\% of cumulative loss  distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 50 replicates with satisfactory AM
convergence are shown as a dashed line."

lossCatAbsUmsyPriorSensCap  <- "Distributions of cumulative absolute 
loss in catch biomass (kt) for the projection years 2026 to 2035 under 
each AM for the $U_{MSY}$ Prior CV sensitivity analysis scenarios (x-axis 
labels). The points show the median loss, while line segments show 
the central 90\\% of cumulative loss  distributions. Panels show the cumulative loss distributions by 
species (columns) and stocks (rows). Each AM point type and 
colour is shown in the legend at the bottom. Loss distributions
for AMs that couldn't reach 50 replicates with satisfactory AM
convergence are shown as a dashed line."

```

```{r stockMap, echo = FALSE, warning = FALSE, fig.cap = DERcplxMapCap }
figPath <- file.path("./data/DERcomplexSurveyBio.pdf")
knitr::include_graphics(figPath)
```

\clearpage


```{r complexYieldCurves, echo = FALSE, warning = FALSE, fig.cap = yieldCurveCap, fig.width = 6 }
# Load a blob, probably just the first one
# in the group folder
plotEffYieldCurves(blob, maxE = 60)

```

\clearpage

\blandscape{}

```{r omniBtCtTulips, echo = FALSE, warning = FALSE, fig.cap = omniBtCtTulipsCap }
figPath <- file.path(projDir,params$baseline,"simReport_files/figure-html/plotTulipBtCt-1.png")
knitr::include_graphics(figPath)
```


\clearpage

```{r omniEffTulips, echo = FALSE, warning = FALSE, fig.cap = omniEffTulipsCap }
figPath <- file.path(projDir,params$baseline,"simReport_files/figure-html/plotTulipEffort-1.png")
knitr::include_graphics(figPath)
```

\clearpage


```{r retroAMfitComparison, echo = FALSE, warning = FALSE, fig.cap = retroBioSampleFitCap, fig.width = 9, out.width = "9in" }
plotRetroBio_Scenario(  groupFolder = params$groupFolder,
                        iRep = 1,
                        scenName = "DERfit_McAsSsIdx",
                        prefix = "DLSurveys",
                        species = "Dover",
                        stock = "HSHG" )
```

\clearpage


<!-- ```{r batchLoss-relCatch, echo = FALSE, warning = FALSE, fig.cap = lossCatRelCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = params$groupFolder,
                              prefix = "parBat",
                              lossType = "rel",
                              var = "C_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 100 )

``` -->

\clearpage

```{r batchLoss-absCatch, echo = FALSE, warning = FALSE, fig.cap = lossCatAbsCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = params$groupFolder,
                              prefix = "parBat",
                              lossType = "abs",
                              var = "C_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 100 )

```

\clearpage

```{r tulipBtCtHMSSurv, echo = FALSE, warning = FALSE, fig.cap = tulipBtCtHMSSurvCap, fig.width = 9, out.width = "9in" }
plotTulipBt(  obj = blob, nTrace = 3,
              dep = TRUE,
              ref = "B0",
              Ct  = TRUE,
              leg = FALSE,
              clearBadReps = TRUE )

```

```{r retroBioSingleRepHMSSurv, echo = FALSE, warning = FALSE, fig.cap = retroBioSingleRepHMSSurvCap, fig.width = 9, out.width = "9in" }
plotRetroSBagg(  obj = blob, iRep = 1 )

```



\clearpage

```{r TACutilisationSSlowCV, echo = FALSE, warning = FALSE, fig.cap = TACutilisationSSLowCVCap, fig.width = 9, out.width = "9in" }
plotTulipTACu( obj = blob, nTrace = 3 )
```

\clearpage
```{r assErrSSlowCV, echo = FALSE, warning = FALSE, fig.cap = assErrSSLowCVCap, fig.width = 9, out.width = "9in" }
plotTulipAssError(  obj = blob,
                    groupFolder = params$groupFolder,
                    save = FALSE,
                    proj = TRUE )
```


<!-- ```{r batchLoss-relSB, echo = FALSE, warning = FALSE, fig.cap = lossBioRelCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = params$groupFolder,
                              prefix = "parBat",
                              lossType = "rel",
                              var = "SB_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 100 )

```
 -->
\clearpage

```{r batchLoss-absSB, echo = FALSE, warning = FALSE, fig.cap = lossBioAbsCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = params$groupFolder,
                              prefix = "parBat",
                              lossType = "abs",
                              var = "SB_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 100 )

```

\clearpage

```{r catchBioTradeoff, echo = FALSE, warning = FALSE, fig.cap = catchBioTradeoffCap, fig.width = 9, out.width = "9in"  }
plotBatchCatchBioTradeoff(  groupFolder = params$groupFolder,
                            prefix = "parBat",
                            period = 73:82,
                            lossList = NULL,
                            qProbs = c(.025,.5,.975),
                            refPts = "MSrefPts",
                            AMlabs = c( SS = "singleStock",
                                        HMS = "hierMultiStock",
                                        SpePool = "speciesPooling",
                                        SpaPool = "spatialPooling",
                                        TA = "totalAgg" ),
                            scenLabs = c( Comm1  = "DERfit_HcMcAsSsIdx",
                                          Comm2  = "DERfit_McAsSsIdx",
                                          Comm3  = "DERfit_McSsIdx",
                                          Surv = "DERfit_AsSsIdx" ),
                            minSampSize = 100  )
```

\clearpage

```{r batchLoss-absC-BmsySens, echo = FALSE, warning = FALSE, fig.cap = lossCatAbsBmsyPriorSensCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = "sensRuns_BmsyCV",
                              prefix = "parBat",
                              lossType = "abs",
                              var = "C_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 50,
                              AMlabs = c( SS = "singleStock",
                                          HMS = "hierMultiStock",
                                          SpePool = "speciesPooling",
                                          SpaPool = "spatialPooling",
                                          TA = "totalAgg" ),
                              scenLabs = c( Comm1_BmsyCV0.1  = "Comm1_BmsyCV0.1",
                                            Surv_BmsyCV0.1  = "Surv_BmsyCV0.1",
                                            Comm1_BmsyCV0.5  = "Comm1_BmsyCV0.5",
                                            Surv_BmsyCV0.5  = "Surv_BmsyCV0.5",
                                            Comm1_BmsyCV1.0  = "Comm1_BmsyCV1.0",
                                            Surv_BmsyCV1.0  = "Surv_BmsyCV1.0" ),
                              rotxlabs = 30, xlab = FALSE
                               )

```

\clearpage

```{r batchLoss-absC-UmsySens, echo = FALSE, warning = FALSE, fig.cap = lossCatAbsUmsyPriorSensCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_Scenario(  groupFolder = "sensRuns_UmsyCV",
                              prefix = "parBat",
                              lossType = "abs",
                              var = "C_ispt",
                              period = 73:82,
                              lossList = NULL,
                              dim1 = 1:3,   # species (D,E,R, DP)
                              dim2 = 1:3,   # stocks (H,Q,W, CW)
                              qProbs = c(.05,.5,.95),
                              clearBadReps = TRUE,
                              minSampSize = 50,
                              AMlabs = c( SS = "singleStock",
                                          HMS = "hierMultiStock",
                                          SpePool = "speciesPooling",
                                          SpaPool = "spatialPooling",
                                          TA = "totalAgg" ),
                              scenLabs = c( Comm1_UmsyCV0.1  = "Comm1_UmsyCV0.1",
                                            Surv_UmsyCV0.1  = "Surv_UmsyCV0.1",
                                            Comm1_UmsyCV0.5  = "Comm1_UmsyCV0.5",
                                            Surv_UmsyCV0.5  = "Surv_UmsyCV0.5",
                                            Comm1_UmsyCV1.0  = "Comm1_UmsyCV1.0",
                                            Surv_UmsyCV1.0  = "Surv_UmsyCV1.0" ),
                              rotxlabs = 30, xlab = FALSE
                               )

```

\elandscape{}