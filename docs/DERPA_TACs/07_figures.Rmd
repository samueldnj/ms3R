\clearpage
# Figures

```{r loadStuff, echo = FALSE, include = FALSE, warning = FALSE}
.loadSim("sim_parBatfixedF_long2", folder= params$groupFolder)

```

1. Loss tulips for a given set of sims?

4. Sample single replicate projection and AM fit (4x4)

5. Sample simulation envelopes?



```{r figCaptions, echo = FALSE, include = FALSE, warning = FALSE }

histStatusCap <- "Historical spawning biomass (red line) and catch (grey bars)
for all 9 management units in the DER complex operating model. Species labels are at the top of each
column, and stock area labels are on the right hand end of each row. Points
are scaled commercial CPUE and survey biomass indices, which are scaled from
data to spawning biomass by observation catchability and the ratio of model
estimates of spawning and exploitable biomass, 
e.g. $\\hat{I}^{(s)}_{spft} = \\frac{I_{spft}}{q_{spf}} \\cdot \\frac{\\hat{B}_{spt}}{\\hat{B}_{spft}}$."


yieldCurveCap <- "Operating model equilibrium yield curves for a given
fishing effort for the nine DER complex management units, as well as 
complex yield curves within each stock area. Each panel shows the three
individual DER complex species yield curves within a given stock area in
different colours, and the complex yield curve found by summing the three
yield curves as a thick black line."

omniBtCtTulipsCap <- "Spawning biomass depletion and relative catch 
simulation envelopes for all nine DER complex management units from 
the omniscient manager simulations. Median biomass is shown by the thick 
black line, with the grey region showing 
the central 95% of the distribution of spawning biomass, and thin black lines 
showing three randomly selected simulation replicates. Catch is shown as grey 
bars in the historical period, which represent median catch in the projection, 
with thin vertical line segments showing the central 95% of the catch 
distribution. The depletion level associated with the traditional single 
species optimal biomass $B_{MSY,SS}$ is shown as a dashed horizontal green 
line, while the depletion level associated with our derived complex 
level multi-species optimal yield is shown as a blue horizontal dashed line.
"

omniEffTulipsCap <- "Commercial fishing effort simulation envelopes for 
each stock area. Historical and median simulated effort in the projection 
period are shown by thicker green (comm.hist) and orange (comm.mod) lines, 
while the central 95% of the distribution of simulated effort is shown as 
the orange shaded region in the projection period. Single simulation 
replicates in the projection period are shown as thinner orange lines."

lossCatRelCap  <- "Distributions of total relative loss in catch 
for the projection years 2026 to 2036 as a function of observation 
error standard deviation multiplier used in the projection period.
The points show the median loss under a single-species (circles) 
and multi-species (triangles) harvest rates, while line segments 
show the interquartile range of loss distributions. Data-pooled
loss is calculated based on the total yield for the DER complex
in a given stock area, and coast-wide loss is calculated 
based on the total yield across the three stock areas."

lossCatAbsCap  <- "Distributions of total absolute loss in catch (kt)
for the projection years 2026 to 2036 as a function of observation 
error standard deviation multiplier used in the projection period. 
The points show the median loss under a single-species (circles) 
and multi-species (triangles) harvest rates, while line segments 
show the interquartile range of loss distributions. Data-pooled
loss is calculated based on the total yield for the DER complex
in a given stock area, and coast-wide loss is calculated 
based on the total yield of across the three stock areas."

lossBioRelCap  <- "Distributions of total relative loss in spawning
biomass for the projection years 2026 to 2036 as a function of 
observation error standard deviation multiplier used in the projection 
period. The points show the median loss under a single-species (circles) 
and multi-species (triangles) harvest rates, while line segments 
show the interquartile range of loss distributions. Data-pooled
loss is calculated based on the total spawning biomass for 
the DER complex in a given stock area, and coast-wide loss is calculated 
based on the total spawning biomass across the three stock areas."

lossBioAbsCap  <- "Distributions of total absolute loss in spawning
biomass (kt)for the projection years 2026 to 2036 as a function of 
observation error standard deviation multiplier used in the projection 
period. The points show the median loss under a single-species (circles) 
and multi-species (triangles) harvest rates, while line segments 
show the interquartile range of loss distributions. Data-pooled
loss is calculated based on the total spawning biomass for the DER complex
in a given stock area, and coast-wide loss is calculated based on the total spawning biomass of a given species across the three
stock areas."


retroBioSingleRepSSLowCVCap <- "Operating model spawning stock
biomass (red line), commercial trawl vulnerable biomass (grey dotted line), 
retrospective assesment model estimates of spawning stock 
biomass (grey lines), and catch and TACs (grey bars) from the first simulation 
replicate with all convergent AMs in the 0.5obssErr scenario and
the SS\\_EmsyHR MP. Catch bars show realised catch in grey 
for the whole simulation period, and unfilled bars in the projection
period show the difference between MP set TACs and realised catch."

TACutilisationSSLowCVCap <- "Simulation envelopes of TAC utilisation
from the 0.5obsErr scenario with the SS\\_EmsyHR management procedure.
Columns are species, rows are stock areas. Heavy black lines show the 
median TAC utilisation, with thin black lines showing 3 
random replicates, and the grey region showing the central 95% 
of simulation's distribution."

assErrSSLowCVCap <- "Simulation envelopes of assessment model errors
from the 0.5obsErr scenario with the SS\\_EmsyHR management procedure.
Columns are species, rows are stock areas. Heavy black lines show the 
median TAC utilisation, with thin black lines showing 3 
random replicates, and the grey region showing the central 95% 
of simulation's distribution."

```

\blandscape{}

```{r histStatus, echo = FALSE, warning = FALSE, fig.cap = histStatusCap }
figPath <- file.path(histPath,"plots/plotSBspt.png")
knitr::include_graphics(figPath)
```

\clearpage

```{r complexYieldCurves, echo = FALSE, warning = FALSE, fig.cap = yieldCurveCap}
# Load a blob, probably just the first one
# in the group folder
plotEffYieldCurves(blob)

```

\clearpage


```{r omniBtCtTulips, echo = FALSE, warning = FALSE, fig.cap = omniBtCtTulipsCap }
figPath <- file.path(projDir,params$baseline,"simReport_files/figure-html/plotTulipBtCt-1.png")
knitr::include_graphics(figPath)
```


\clearpage

```{r omniEffTulips, echo = FALSE, warning = FALSE, fig.cap = omniEffTulipsCap }
figPath <- file.path(projDir,params$baseline,"simReport_files/figure-html/plotTulipEffort-1.png")
knitr::include_graphics(figPath)
```

\clearpage



<!-- ```{r batchLoss-relCatch, echo = FALSE, warning = FALSE, fig.cap = lossCatRelCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_CV(  groupFolder = "diffCV_fixedF_longGrid",
                        prefix = "sim_parBatfixedF",
                        lossType = "rel",
                        var = "C_ispt",
                        period = 73:82,
                        lossList = NULL,
                        dim1 = 1:4,   # species (D,E,R, DP)
                        dim2 = 1:4,   # stocks (H,Q,W, CW)
                        qProbs = c(.25,.5,.75) )

```


\clearpage -->

```{r batchLoss-absCatch, echo = FALSE, warning = FALSE, fig.cap = lossCatAbsCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_CV(  groupFolder = "diffCV_fixedF_longGrid",
                        prefix = "sim_parBatfixedF",
                        lossType = "abs",
                        var = "C_ispt",
                        period = 73:82,
                        lossList = NULL,
                        dim1 = 1:4,   # species (D,E,R, DP)
                        dim2 = 1:4,   # stocks (H,Q,W, CW)
                        qProbs = c(.25,.5,.75) )

```

\clearpage

```{r retroBioSingleRepSSLowCV, echo = FALSE, warning = FALSE, fig.cap = retroBioSingleRepSSLowCVCap, fig.width = 9, out.width = "9in" }
plotRetroSBagg(  obj = blob, iRep = 1 )

```

\clearpage

```{r TACutilisationSSlowCV, echo = FALSE, warning = FALSE, fig.cap = TACutilisationSSLowCVCap, fig.width = 9, out.width = "9in" }
plotTulipTACu( obj = blob, nTrace = 3 )
```

\clearpage
```{r assErrSSlowCV, echo = FALSE, warning = FALSE, fig.cap = assErrSSLowCVCap, fig.width = 9, out.width = "9in" }
plotTulipAssError(  obj = blob,
                    groupFolder = params$groupFolder,
                    save = FALSE,
                    proj = TRUE )
```


<!-- ```{r batchLoss-relSB, echo = FALSE, warning = FALSE, fig.cap = lossBioRelCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_CV(  groupFolder = "diffCV_fixedF_longGrid",
                        prefix = "sim_parBatfixedF",
                        lossType = "rel",
                        var = "SB_ispt",
                        period = 73:82,
                        lossList = NULL,
                        dim1 = 1:4,   # species (D,E,R, DP)
                        dim2 = 1:4,   # stocks (H,Q,W, CW)
                        qProbs = c(.25,.5,.75) )

```
 -->
\clearpage

```{r batchLoss-absSB, echo = FALSE, warning = FALSE, fig.cap = lossBioAbsCap, fig.width = 9, out.width = "9in" }
plotBatchLossDists_CV(  groupFolder = "diffCV_fixedF_longGrid",
                        prefix = "sim_parBatfixedF",
                        lossType = "abs",
                        var = "SB_ispt",
                        period = 73:82,
                        lossList = NULL,
                        dim1 = 1:4,   # species (D,E,R, DP)
                        dim2 = 1:4,   # stocks (H,Q,W, CW)
                        qProbs = c(.25,.5,.75) )

```

\elandscape{}

